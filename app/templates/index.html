{% extends "base.html" %}
{% block content %}

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="row">
                    <div class="container">
                        <div id="map-canvas"></div>
                    </div>

                    <div class="container">
                        <div id="slider" class=" col-md-10"></div>
                        <div class=" col-md-1"><h3 id="slider_value"></h3></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}

    <script src="https://maps.googleapis.com/maps/api/js?libraries=visualization,drawing,key=AIzaSyBmROUiZ37aAcA_dxjlwnkdmEBW3qIxos0"></script>

    <script>
        // Not sure if this works like this
        var pointArray;
        $(document).ready(function () {
            var map, pointarray, heatmap;

            var sentimentData = [
                {location: new google.maps.LatLng(55.951663, -3.206273), weight: 5},
                {location: new google.maps.LatLng(55.954708, -3.302416), weight: 1},
                {location: new google.maps.LatLng(55.97194, -3.224334), weight: 1},
                {location: new google.maps.LatLng(55.959472, -3.249847), weight: 3}
            ];

            function initialize() {
                var mapOptions = {
                    zoom: 13,
                    center: new google.maps.LatLng(55.953, -3.188),
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                };

                map = new google.maps.Map(document.getElementById('map-canvas'),
                        mapOptions);

                // Change this to change heatmap
                pointArray = new google.maps.MVCArray(sentimentData);

                heatmap = new google.maps.visualization.HeatmapLayer({
                    data: pointArray
                });

                heatmap.setMap(map);
            }

            function toggleHeatmap() {
                heatmap.setMap(heatmap.getMap() ? null : map);
            }

            function changeGradient() {
                var gradient = [
                    'rgba(165,0,38, 0)',
                    'rgb(222,119,174)',
                    'rgb(253,224,239)',
                    'rgb(230,245,208)',
                    'rgb(184,225,134)',
                    'rgb(127,188,65)'
                ]
                heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
            }

            function changeRadius() {
                heatmap.set('radius', heatmap.get('radius') ? null : 30);
            }

            function changeOpacity() {
                heatmap.set('opacity', heatmap.get('opacity') ? null : 1);
            }

            google.maps.event.addDomListener(window, 'load', initialize);

            function startup() {
                changeRadius();
                changeOpacity();
                changeGradient();
            }

        });


        $("#slider").slider({
            //TODO make dynamic with hours and days
            value: 50,
            min: 0,
            max: 100,
            slide: function (event, ui) {
                $("#slider_value").html(ui.value);
                ui.value;
            },
            stop: function (event, ui) {
                console.log(ui);
                $.ajax("/get_coords", {
                    data: {'data_value': ui.value},
                    method: "POST",
                    complete: function (a, b) {
                        console.log(a);
                        console.log(b);
                    }
                })
            }
        });
    </script>
{% endblock %}